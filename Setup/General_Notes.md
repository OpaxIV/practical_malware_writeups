# Practical Malware Analysis

## Websites

- [VirusTotal](https://www.virustotal.com/gui/home/upload)
- WinXP SP3 ISO - https://archive.org/details/WinXPProSP3x86

## Tools (Static Analysis)

- [Strings - Sysinternals | Microsoft Learn](https://learn.microsoft.com/en-us/sysinternals/downloads/strings)

- https://upx.github.io/

- [GitHub - wolfram77web/app-peid: PEiD detects most common packers, cryptors and compilers for PE files.](https://github.com/wolfram77web/app-peid)

- https://www.dependencywalker.com/

- [WJR Software - PEview (PE/COFF file viewer),...](http://wjradburn.com/software/)

- [Resource Hacker](https://www.angusj.com/resourcehacker/)

## Newer Tools (Static Analysis)

- [Winitor](https://www.winitor.com/download)

- [GitHub - hasherezade/pe-bear: Portable Executable reversing tool with a friendly GUI](https://github.com/hasherezade/pe-bear)

- [GitHub - horsicq/Detect-It-Easy: Program for determining types of files for Windows, Linux and MacOS.](https://github.com/horsicq/Detect-It-Easy)

## Tools (Dynamic Analysis)

- Regshot - [GitHub - https://github.com/Seabreg/Regshot

- Sysinternals (Including Process Monitor and Process Explorer) - [Sysinternals - Sysinternals | Microsoft Learn](https://learn.microsoft.com/en-us/sysinternals/)

- Regshot - [GitHub - Seabreg/Regshot: Regshot is a small, free and open-source registry compare utility that allows you to quickly take a snapshot of your registry and then compare it with a second one - done after doing system changes or installing a new software product](https://github.com/Seabreg/Regshot)

- Analysis Tools (including apatedns) - [GitHub - theRealFr13nd/analysisTools: Malware analysis tools used alongside &quot;Practical Malware Analysis: The Hands-on Guide to Dissecting Malicious Software&quot; Book by Andrew Honig and Michael Sikorski](https://github.com/theRealFr13nd/analysisTools)

- Pafish - [GitHub - a0rtega/pafish: Pafish is a testing tool that uses different techniques to detect virtual machines and malware analysis environments in the same way that malware families do](https://github.com/a0rtega/pafish)

## Setting up the Virtual Environment

- **OS:** *WinXP SP3*
  - **Product Key:** HH7VV-6P3G9-82TWK-QKJJ3-MXR96
  - **Other Product Keys:** [GitHub - Fuwn/xp: ðŸ’» Windows XP All Editions Universal Product Keys Collection](https://github.com/Fuwn/xp/)
- **Network:** "Bridged"" (when in need of network) / else "Host-Only" or "Turned Off"
- **RAM:** 4 GB
- **Processor(s):** 2
- **Storage:** 50 GB

### Network Setup

It is important to choose the correct Network setup. Depending on the use case, you might want to use another setup.

[pre]+-----------+-------------+-------------+----------------+----------------+  
| | VM <-> Host | VM1 <-> VM2 | VM -> Internet | VM <- Internet |  
+-----------+-------------+-------------+----------------+----------------+  
| HostOnly | **Yes** | **Yes** | No | No |  
| Internal | No | **Yes** | No | No |  
| Bridged | **Yes** | **Yes** | **Yes** | **Yes** |  
| NAT | No | No | **Yes** | Port forward
| NATNet | No | **Yes** | **Yes** | Port|  
+-----------+-------------+-------------+----------------+----------------+[/pre]

For my approach, I used the internal network option. For this navigate into your VMs settings and choose an internal network (or type the name of a new one) under the network tab.

In the VMs you need to change the following:

- **Win10 VM:**
  
  - Go to adapter settings and set:
    
    - **IPv4:** 192.168.100.100
    
    - **Subnet Mask:** 255.255.255.0
    
    - **Default Gateway:** 192.168.100.1
  
  - In the Advanced Settings of the Windows firewall, make sure any rules similar to the following are activated (Inbound Rules):
    
    - File and Printer Sharing (Echo Request - ICMPv4-In)

- **Kali Linux VM:**
  
  - Check your adater's name with the console's command `ifconfig`.
  
  - Modify the file `/etc/network/interfaces` with sudo privileges and an editor program (gedit, vim, nano...)
  
  - Append the following:
    
    - auto <your interface>
    
    - iface <your interface> inet static
    
    - address 192.168.100.101 *# ip address used in my example*
    
    - netmask 255.255.255.0
  
  - Reboot the machine
  
  Check the functionality of the network by pinging VM1 <--> VM2. Make sure that no ping is possible to the host machine.

- Setting up INetSim:
  
  - Modify the file `/etc/inetsim/inetsim.conf` with sudo privileges and an editor program (gedit, vim, nano...)
  
  - Under the section **# service_bind_address** add `service_bind_address 192.168.100.101` (the IP of my kali VM). "0.0.0.0" should also work.
  
  - Under the section **# dns_default_ip** add `dns_default_ip 192.168.100.101` (the IP of my kali VM).
  
  - Run INetSim with `sudo inetsim` and make sure that the IP is correct.

- Testing INetSim:
  
  - Try downloading the file from *https://<your INetSim IP>/mal.exe*.
  
  - After terminating the session with CTRL+C a log file should been have created. Check it's contents to make sure, that your setup works

References:

- [Learning Malware Analysis](https://subscription.packtpub.com/book/security/9781788392501/1/ch01lvl1sec14/5-setting-up-the-lab-environment)

- [virtual machine - Kali VM not pinging Windows 7 VM but vice versa is possible - Super User](https://superuser.com/questions/1088651/kali-vm-not-pinging-windows-7-vm-but-vice-versa-is-possible)

- [A Guide To Setting Up Your Malware Analysis Lab.](https://vulnresearch.hashnode.dev/the-groundwork-a-guide-to-setting-up-your-malware-analysis-lab)

- [virtual machine - Kali VM not pinging Windows 7 VM but vice versa is possible - Super User](https://superuser.com/questions/1088651/kali-vm-not-pinging-windows-7-vm-but-vice-versa-is-possible)

- https://whiteheart0.medium.com/dynamic-malware-analysis-lab-setup-613075f9423f 
