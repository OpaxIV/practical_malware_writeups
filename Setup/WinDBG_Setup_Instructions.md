# WinDBG Setup Instructions

I am using a Windows XP and a Windows 10 machine. Win10 is used for running WinDBG, WinXP is the OS running the malware.


On the Windows 10 Host:
1. Setting the Environment Variable
    - Got to https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-symbols
    - Under "Debugger Reference --> Environment Variables --> General Environment Variables" you will find the name of the variable.
    - Under the same link go to "Symbols for Windows Debugging --> Symbol path for Windows debuggers" to find the needed path.
    - Using the command line input the following commands:
        - Create a new folder for the symbols to be installed (mine is "C:\symbols")
            `md c:\symbols`
        - Input the command to create a new environmenal variables:
            `setx _NT_SYMBOL_PATH "cache*c:\symbols;srv*https://msdl.microsoft.com/download/symbols"`





https://samsclass.info/126/proj/p12-WinDbg-PC
https://reverseengineering.stackexchange.com/questions/13805/windows-xp-kernel-debugging
https://forums.virtualbox.org/viewtopic.php?t=97395
https://docs.oracle.com/en/virtualization/virtualbox/6.0/user/serialports.html
https://www.codeproject.com/Questions/164972/Where-is-WinDbg-and-how-do-i-launch-it-either-in-c


useful:
https://forums.virtualbox.org/viewtopic.php?t=26860
https://forums.virtualbox.org/viewtopic.php?p=429444
https://forums.virtualbox.org/viewtopic.php?f=6&t=63585
https://forums.virtualbox.org/viewtopic.php?f=6&t=80630




add symbols file path in windbg? every time?

disable clipboard vm both


# XP Guest


How to add a physical serial port.
In Guest Settings for Serial Ports set as follow
Port1: Checked
Port Number: COM1
Port Mode: Host Device
Windows Host:
Port/File Path: COM1:
Note the colon in COM1: (not semicolon). I have experienced the guest could become unstable without it.
For a host port number higher than 9, the naming \\.\comX where X is the port number, is required. This can also be used for a one digit port number.



Open Add Hardware from the Control Panel.
After searching for hardware select ‘Yes, I have already connected the hardware’ and Next.
Go to the bottom and select ‘Add a new hardware device’
Select ‘Install the hardware that I manually select from a list’
Select ‘Ports (COM & LPT)’
Select ‘Communication Port’ from Standard port types.
Continue with Next until finished.


WIN7:
From the Action menu select Add legacy hardware.
Select Next, ‘Install the hardware that I manually select from a list’ and Next
Select ‘Ports (COM & LPT)’ and Next
Select ‘Communication Port’ from Standard port types.
Continue with Next and Finish.


In the Device Manager you should now see the COM3 port with a yellow warning icon.

Open Properties for the COM3 port.
Select Advanced from Port Settings.
Choose COM1 from the ‘COM Port Number’ (Ignore possible 'In Use')
In the Resources tab select ‘Set Configuration Manually’ if you see it.
In Windows 7 uncheck ‘Use automatic settings’
Select the configuration that corresponds to the VirtualBox settings as noted – likely configuration 0000.
Close the box and you should be asked to reboot.
After reboot the COM1 port should now be working.



TEST: RUN WIN10 FIRST, THEN XP


VERR_NET_HOST_NOT_FOUND


# VMbox Settings



For a direct connection between two virtual machines, corresponding to a null-modem cable, simply configure one VM to create a pipe or socket and another to attach to it. 

https://docs.oracle.com/en/virtualization/virtualbox/6.0/user/serialports.html


## Machine with Kernel Debugging Enabled

Port Mode:


## Machine using WinDBG

\\.\pipe\NAME




\\.\\pipe\\VBoxTrayIPC-fabio



https://www.aloneguid.uk/posts/2022/09/list-named-pipes-windows/

cmd.exe:        pipelist.exe
powershell:     [System.IO.Directory]::GetFiles("\\.\\pipe\\")






---
References:
-How to set up a VirtualBox lab to debug Kernel Driver with Windbg - https://github.com/OpaxIV/kernel-debug-lab-for-virtual-box
- NetExt Series: Install WinDbg - https://www.youtube.com/watch?v=dbpmOLMpAcc
