# Lab 1

## Lab 1-1

This lab uses the files Lab01-01.exe and Lab01-01.dll. Use the tools and techniques described in the chapter to gain information about the files and answer the questions below.

1. Upload the files to [VirusTotal - Home](https://www.virustotal.com/gui/home/upload) and view the reports. Does either file match any existing antivirus signatures?
   
   - **Lab01-01.exe:**
     
     - *Score:* 55/72 of VirusTotal Partners see this file as malicious
     
     - *SHA256:* 58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe47
     
     - *Type:* PEexe
   
   - **Lab01-01.dll:**
     
     - *Score:* 44/71 of VirusTotal Partners see this file as malicious
     
     - *SHA256:* f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba
     
     - *Type:* PEdll

2. When were the files compiled?
   
   - **Lab01-01.exe:** compiler-stamp,Sun Dec 19 16:16:19 2010 | UTC
   
   - **Lab01-01.dll:** compiler-stamp,Sun Dec 19 16:16:38 2010 | UTC

3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?
   
   - **Lab01-01.exe:** Not packed, linker is visible and many strings
   
   - **Lab01-01.dll:** Not packed, linker is visible and many strings

4. Do any imports hint at what this malware does? If so, which imports are they?
   
   - **Lab01-01.exe:** Imports from libraries `KERNEL32.dll` and `MSVCRT.dll`
     
     - *Memory Mangement:* malloc
     
     - *File Management:* `CreateFileMappingA`, `CreateFileA`, `CloseHandle`, `FindFirstFileA`
     
     - *String Comparasion:* `_stricmp`
   
   - **Lab01-01.dll:** Imports from libraries `KERNEL32.dll`, `WS2_32.dll` (provides Network Functionality) and `MSVCRT.dll`
     
     - *Memory Mangement:* malloc, free
     
     - *Network / Socket Connection:* 23 (socket), 11 (inet_addr), 3 (closesocket)
     
     - *Process Management:* CreateProcessA, Sleep

5. Are there any other files or host-based indicators that you could look for on infected systems?
   
   - **Lab01-01.exe:** Interesting Strings like *Lab01-01.dll* and *C:\windows\system32\kerne132.dll*.
   
   - **Lab01-01.dll:** Interesting Strings like the IP-address *127.26.152.13* and `WS2_32.dll`.

6. What network-based indicators could be used to find this malware on infected machines?
   
   - **Lab01-01.exe:** Does not seem to have network functionality.
   
   - **Lab01-01.dll:** IP-address *127.26.152.13 and `WS2_32.dll`.

7. What would you guess is the purpose of these files?
   
   - The Lab01-01.exe is used to run/install the Lab01-01.dll file (.dll files can't run by their own).
   
   - The Lab01-01.dll is possibly a backdoor, used to download files from the internet.

## Lab 1-2

Analyze the file Lab01-02.exe.

1. Upload the Lab01-02.exe file to [VirusTotal - Home](https://www.virustotal.com/gui/home/upload). Does it match any existing antivirus definitions?
   
   - *Score:* 55/70 of VirusTotal Partners see this file as malicious
   
   - *SHA256:* c876a332d7dd8da331cb8eee7ab7bf32752834d4b2b54eaa362674a2a48f64a6
   
   - *Type:* PEexe

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
   
   - **Packed:**
     
     - **Signature:** *UPX -> www.upx.sourceforge.net*
     
     - **Sections:**  *two sections named "UPX1" and "UPX2".*
     
     - **Section Sizes (before unpacking):**
       
       - raw-size (2048 bytes):
         
         - *section[0]/ UPX0:* 0x00000000 (0 bytes)
         
         - *section[1]/ UPX1:* 0x00000600 (1536 bytes)
         
         - *section[2]/ UPX2:* 0x00000200 (512 bytes)
       
       - virtual-size (24576 bytes):
         
         - *section[0]/ UPX0:* 0x00004000 (16384 bytes)
         
         - *section[1]/ UPX1:* 0x00001000 (4096 bytes)
         
         - *section[2]/ UPX2:* 0x00001000 (4096 bytes)
       
       - **Section Sizes (after unpacking):**
         
         - `upx -o newFilename -d originalFilename`
         
         - Total size from 3072 (3 KB) --> 16384 (1.6 KB)
         
         - raw-size (2048 bytes):
           
           - *section[0]/ UPX0:* 0x00001000 (4096 bytes)
           
           - *section[1]/ UPX1:* 0x00001000 (4096 bytes)
           
           - *section[2]/ UPX2:* 0x00001000 (4096 bytes)
         
         - virtual-size (24576 bytes):
           
           - *section[0]/ UPX0:* 0x000002DC (732 bytes)
           
           - *section[1]/ UPX1:* 0x00000372 (882 bytes)
           
           - *section[2]/ UPX2:* 0x0000008C (140 bytes)

3. Do any imports hint at this program's functionality? if so, which imports are they and what do they tell you?
   
   - **KERNEL32.DLL:**
     
     - exposes to applications most of the Win32 base APIs, such as memory management, input/output (I/O) operations, process and thread creation, and synchronization functions.
     
     - `CreateWaitableTimerA`
     
     - `OpenMutexA`
     
     - `SetWaitableTimer`
     
     - `WaitForSingleObject`
     
     - `CreateMutexA`
     
     - `SystemTimeToFileTime`
     
     - `ExitProcess`
     
     - `CreateThread`
     
     - `GetModuleFileNameA`
   
   - **ADVAPI32.dll:**
     
     - Advanced Windows 32 Base API DLL, provides security calls and functions for manipulating the Windows Registry.
     
     - `CreateServiceA`
     
     - `StartServiceCtrlDispatcherA`
     
     - `OpenSCManagerA`
   
   - **MSVCRT.dll:**
     
     - C standard library for the Visual C++ (MSVC) compiler from version 4.2 to 6.0. It provides programs compiled by these versions of MSVC with most of the standard C library functions. These include string manipulation, memory allocation, C-style input/output calls, and others. **MSVCP*.DLL** is the corresponding C++ library.
     
     - `_exit`
     
     - `_XcptFilter`
     
     - `exit`
     
     - `__p___initenv`
     
     - `__getmainargs`
       `_initterm`
     
     - `__setusermatherr`
     
     - `_adjust_fdiv`
     
     - `__p__commode`
     
     - `__p__fmode`
     
     - `__set_app_type`
     
     - `_except_handler3`
     
     - `_controlfp`
   
   - **WININET.dll:**
     
     - Allows access to FTP and HTTP protocols to access Internet resources.
     
     - `InternetOpenUrlA`
     
     - `InternetOpenA`

4. What host- or network-based indicators could be used to identify this malware on infected machines?
   
   - Program connects to the Internet (`InternetOpenUrlA`, `InternetOpenA`)
   
   - Creates service (`CreateServiceA`)
   
   - Strings like *http://malwareanalysisbook.com* (maybe used by `InternetOpenUrlA` and `Malservice`)
   
   - (According to the solutions, the function `Malservice` should also be listed as an import. I couldn't reproduce this step as by the time of this writing. It could be because of incompabilities with newer programs / OSes.)

## Lab 1-3

Analyze the file Lab01-03.exe

1. Upload the Lab01-03.exe file to [VirusTotal - Home](https://www.virustotal.com/gui/home/upload). Does it match any existing antivirus definitions?
   
   - **Score:** *63/72 of VirusTotal Partners see this file as malicious*
   
   - **SHA256:** *7983a582939924c70e3da2da80fd3352ebc90de7b8c4c427d484ff4f050f0aec*
   
   - **Type:** *PEexe*

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
   
   - **Packed:**
     
     - **Signature:** *signature,FSG 1.00 (Eng) -> dulek/xt*
     
     - **Sections:**
       
       - *Sections have no names.*
       
       - *First section has a raw-size of 0x00000000 (0 bytes) and virtual-size of 0x00003000 (12288 bytes).*
     
     - **Function Imports:** *Only two, `LoadLibraryA` and  `GetProcAddress`*
     
     - **Libraries:** *`KERNEL32.dll` only, which is used by most of the Windows programs.*

3. Do any imports hint at this program's functionality? if so, which imports are they and what do they tell you?
   
   - At the current stage, we do not have the tools/skills to unpack this file.

4. What host- or network-based indicators could be used to identify this malware on infected machines?
   
   - At the current stage, we do not have the tools/skills to unpack this file.

## Lab 1-4

Analyze the file Lab01-04.exe

1. Upload the Lab01-04.exe file to [VirusTotal - Home](https://www.virustotal.com/gui/home/upload). Does it match any existing antivirus definitions?
   
   - **Score:** *63/72 of VirusTotal Partners see this file as malicious*
   
   - **SHA256:** *7983a582939924c70e3da2da80fd3352ebc90de7b8c4c427d484ff4f050f0aec*
   
   - **Type:** *PEexe*

2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.
   
   - **Unpacked:**
     
     - **Signature:** *Microsoft Visual C++ v6.0*
     
     - **Sections:**
       
       - *Named from section[0] to section[3].*
       
       - **Section Sizes:**
         
         - raw-size (2048 bytes):
           
           - *section[0] / .text:* 0x00001000 (4096 bytes)
           
           - *section[1] /  .rdata:* 0x00001000 (4096 bytes)
           
           - *section[2] / .data:* 0x00001000 (4096 bytes)
           
           - *section[3] / .rsrc:* 0x00005000 (20480 bytes)
         
         - virtual-size (24576 bytes):
           
           - *section[0] / .text:* 0x00000720 (1824 bytes)
           
           - *section[1] / .rdata:* 0x000003D2 (978 bytes)
           
           - *section[2] / .data:* 0x0000014C (332 bytes)
           
           - *section[3] / .rsrc:* 0x00004060 (16480 bytes)
     
     - **Function Imports:** *Only two, `LoadLibraryA` and `GetProcAddress`*
     
     - **Libraries:** *`KERNEL32.dll` only, which is used by most of the Windows programs.

3. When was this program compiled?
   
   - *compiler-stamp,Fri Aug 30 22:26:59 2019 | UTC*
   
   - *Since this book is older, the time is fake.*

4. Do any imports hint at this program's functionality? if so, which imports are they and what do they tell you?
   
   - The imports from the `ADVAPI32.dll` llibrary seem to indicate a sort of permission functionality.
   
   - The imports from the `KERNEL32.dll` llibrary seem to indicate a writing (`WriteFile`) and executing (`WinExec`) of a file.
   
   - **KERNEL32.dll:**
     
     - `CreateRemoteThread`
     
     - `GetCurrentProcess`
   
   - **ADVAPI32.dll:**
     
     - `OpenProcessToken`
     
     - `LookupPrivilegeValueA`
     
     - `AdjustTokenPrivileges`
   
   - **MSVCRT.dll:**
     
     - `_snprintf`
     
     - `_exit`
     
     - `_XcptFilter`
     
     - `exit`
     
     - `__p___initenv`
     
     - `__getmainargs`
     
     - `_initterm`
     
     - `__setusermatherr`
     
     - `_adjust_fdiv`
     
     - `__p__commode`
     
     - `__p__fmode`
     
     - `__set_app_type`
     
     - `_except_handler3`
     
     - `_controlfp`
     
     - `_stricmp`

5. What host- or network-based indicators could be used to identify this malware on infected machines?
   
   - **Strings:**
     
     - *There is a possibility, that the malware writes a file at the location "\system32\wupmgr.exe".*
     
     - Works with / accesses the URL http://www.practicalmalwareanalysis.com/updater.exe*

6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?
   
   - *With pestudio --> resources --> doubleclick on the signature --> save the objdump*
     
     - **File Type:** *PE32 executable*
     
     - **OS:** *Operation system: Windows(95)[I386, 32-bit, GUI]*
     
     - **Compiler:** *Microsoft Visual C/C++(12.00.8168)[C++/std]*
   
   - **Strings:**
     
     - Propably downloads other files (malware?) with `URLDownloadToFileA` and executes it with `WinExec`
