# Lab 5

## Lab 5-1

Analyze the malware found in the file Lab05-01.dll using only IDA Pro. The goal of this lab is to give you hands-on experience with IDA Pro. If you've already worked with IDA Pro, you may choose to ignore these questions and focus on reverse-engineering the malware.

1. What is the address of `DllMain`?
   
   - 0x1000D02E
   
   - in the .text section

2. Use the Imports window to browse to `gethostbyname`. Where is the import located?
   
   - 0x100163CC
   
   - in the .idata section

3. How may functions call `gethostbyname`?
   
   - Hit *CTRL + X* after having highlighted the function's name `gethostbyname` in the disassembly
     
     <img title="" src="file:///C:/Users/Fabio/AppData/Roaming/marktext/images/2023-12-05-15-18-50-image.png" alt="" data-align="inline" width="660">
   
   - The function gets called 18 times (18 lines).
     
     - 9 of which are type (p) for the near call
     
     - 9 are read (r)
     
     - in total 5 unique calling functions

4. Focusing on the call to `gethostbyname` located at 0x10001757, can you figure out which DNS request will be made?
   
   - Arguments are one of the first of being pushed onto the stack
   
   - In this case we can see `off_10019040` being moved into `eax`. This happends before the call to `gethostbyname`.
   
   - As such `gethostbyname` takes one argument, which in this case contains `[This is RDO]pics.practicalmalwareanalysis.com`.
   
   - In a next step 0xD gets added to `eax`, which is 13 in decimal (can be converted as such via right-click). With this `eax` "points" to 13 characters into the string, hence at "pics.practicalmalwareanalysis.com".

5. How many local variables has IDA Pro recognized for the subroutine at 0x10001656?
   
   - Local Variables have negative offsets
   
   - 24 variables in total, of which 23 are local variables
     
     ```
                       var_675 = byte ptr -675h
                       var_674 = dword ptr -674h
                       hModule = dword ptr -670h
                       timeout = timeval ptr -66Ch
                       name    = sockaddr ptr -664h
                       var_654 = word ptr -654h
                       in      = in_addr ptr -650h
                       Str1    = byte ptr -644h
                       var_640 = byte ptr -640h
                       CommandLine= byte ptr -63Fh
                       Str     = byte ptr -63Dh
                       var_638 = byte ptr -638h
                       var_637 = byte ptr -637h
                       var_544 = byte ptr -544h
                       var_50C = dword ptr -50Ch
                       var_500 = byte ptr -500h
                       Buf2    = byte ptr -4FCh
                       readfds = fd_set ptr -4BCh
                       buf     = byte ptr -3B8h
                       var_3B0 = dword ptr -3B0h
                       var_1A4 = dword ptr -1A4h
                       var_194 = dword ptr -194h
                       WSAData = WSAData ptr -190h
                       lpThreadParameter= dword ptr  4
     ```

6. How many parameters has IDA Pro recognized for the subroutine at 0x10001656?
   
   - Parameters have positive offsets, hence 1

7. Use the Strings window to locate the string \cmd.exe /c in the disassembly. Where is it located?
   
   - Found trough the Strings Window at 0x10095B34, which is stored in `aCmdExeC`, located in the xdoors_d section of the PE file.
   
   - Following the XREF we get to the subroutine `sub_1000FF58+278` :
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-07-02-57-image.png)
     
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-07-05-31-image.png)
   
   - The String is effectively stored at 0x100101D0 (0x1000FF58+278 offset)

8. What is happening in the area of code that references \cmd.exe /c?
   
   - Synthax:
     
     ```batch
     cmd [/c|/k] [/s] [/q] [/d] [/a|/u] [/t:{<b><f> | <f>}] [/e:{on | off}] [/f:{on | off}] [/v:{on | off}] [<string>]
     ```
   
   - The command `cmd.exe` opens a new instance of the windows terminal.
   
   - `/c` - Carries out the command specified by `<string>` and then exits the command processor.
   
   - Looking around in the graph view of the sub_1000FF58 function, we can see multiple Strings/variables with names like "install", "inject", "cd" etc., which get compared by functions like `memcmp`.
     
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-07-21-06-image.png)
   
   - When clicking around the `aCmdExeC`, we even see an interesting char array:
     
     ```
     xdoors_d:10095B44 ; char aHiMasterDDDDDD[]
     xdoors_d:10095B44 aHiMasterDDDDDD db 'Hi,Master [%d/%d/%d %d:%d:%d]',0Dh,0Ah
     xdoors_d:10095B44                                         ; DATA XREF: sub_1000FF58+145↑o
     xdoors_d:10095B63                 db 'WelCome Back...Are You Enjoying Today?',0Dh,0Ah
     xdoors_d:10095B8B                 db 0Dh,0Ah
     xdoors_d:10095B8D                 db 'Machine UpTime  [%-.2d Days %-.2d Hours %-.2d Minutes %-.2d Secon'
     xdoors_d:10095BCE                 db 'ds]',0Dh,0Ah
     xdoors_d:10095BD3                 db 'Machine IdleTime [%-.2d Days %-.2d Hours %-.2d Minutes %-.2d Seco'
     xdoors_d:10095C14                 db 'nds]',0Dh,0Ah
     xdoors_d:10095C1A                 db 0Dh,0Ah
     xdoors_d:10095C1C                 db 'Encrypt Magic Number For This Remote Shell Session [0x%02x]',0Dh,0Ah
     xdoors_d:10095C59                 db 0Dh,0Ah,0
     ```
   
   - So it seems like, that the function is used to open a remote shell.

9. In the same area, at 0x100101C8, it looks like dword_1008E5C4 is a global variable that helps decide which path to take. How does the malware set dword_1008EC5? (Hint: Use dword_1008EC50's cross-references.)
   
   - Found at 0x100101C8:
     
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-18-57-14-image.png)
   
   - In the disassembly, hit *CTRL + X* while being on the variable. The following window will appear:
     
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-00-12-image.png)
   
   - By looking at the instructions, we can see only one of them being a manipulation of the variable (`mov dword_1008E5C4, eax`).
   
   - If we investigate further, we can spot the origin of where `eax` was last manipulated, before being compared to the variable `dword_1008E5C4`.
     
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-03-42-image.png)
   
   - Looking into `sub_10001000` we can see how eax gets manipulated. Finally containing a string called `String1`:
     
     ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-14-03-image.png)

10. A few hundred lines into the subroutine at 0x1000FF58, a series, of comparasions use memcmp to compare strings. What happens if the string comparasion to `robotwork` is successfull (when memcmp returns 0)?
    
    - Found at 0x1001044C
      
      ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-19-24-image.png)
    
    - `memcmp` - compares memory areas
      
      - `int memcmp(const void s1[.n], const void s2[.n], size_t n);`
      
      - The **memcmp**() function compares the first *n* bytes (each interpreted as *unsigned char*) of the memory areas *s1* and *s2*.
      
      - Return value:
        
        - `<0`: n_s1 < n_s2
        
        - `=0` : n_s1 = n_s2
        
        - `>0` : n_s1 > n_s2
      
      - Ref: [memcmp(3) - Linux manual page](https://man7.org/linux/man-pages/man3/memcmp.3.html)
    
    - The return value of `memcmp` gets loaded into `eax` (32bit calling covention) and checked via `test eax, eax` instruction. The `test` instruction peforms an AND-operation on the values in `eax` and only returns 0, if the content of `eax`is actually 0 (hence `memcmp` == 0).
    
    - In other words, if the strings are not equal, a jump is taken (`jnz`) to `loc_10010468`.
    
    - If the two strings are not equal, the function continues at 0x1001045E.
    
    - **sub_100052A2:**
      
      - At this point the `sub_100052A2` function is called, in which more interesting strings and even a registry key are to be found.
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-47-00-image.png)
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-47-11-image.png)
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-47-26-image.png)
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-47-48-image.png)
    
    - The function's signature `int __cdecl sub_100052A2(SOCKET s)`  implies the usage of `SOCKET s` as an argument.
    
    - The parameter `s` is then passed to the function `sub_100038EE`:
      
      ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-06-19-55-15-image.png)
    
    - Therefore, if the string comparison for `robotwork` is successful, the registry keys `SOFTWARE\Microsoft\Windows\CurrentVersion` `WorkTime` and `WorkTimes` are queried and the values passed through (likely) the remote shell connection.

11. What does the export PSLIST do?
    
    - Starts at 0x10007025
    
    - Function Signature: `int __stdcall PSLIST(int, int, char *Str, int)`
      
      - takes three integer and a char array (string) as parameters
      
      ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-07-18-57-29-image.png)
    
    - The subroutine `sub_100036C3` is called before the conditional jump.
      
      - The subroutine contains functions like `GetVersionExA`, which returns the operating system's version. - [GetVersionExA function (sysinfoapi.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getversionexa)
      
      - There are also two structs / arrays with names `VersionInformation` and `dwOSVersionInfoSize`.
      
      - `VersionInformation` is a variable which contains the struct `OSVERSIONINFOA`, in which information about the OS are stored - [OSVERSIONINFOA (winnt.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-osversioninfoa)
      
      - `dwOSVersionInfoSize` - The size of this data structure, in bytes
      
      - There are two conditional jumps, which occur if `cmp     [ebp+VersionInformation.dwPlatformId], 2` is true, and in the second case if `cmp     [ebp+VersionInformation.dwMajorVersion], 5` applies.
      
      - If the jumps are not taken, `eax` gets returned containing the `VersionInformation` variable.
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-07-19-09-54-image.png)
    
    - We then return to `PSLIST`. As a conclusion one can state the multiple comparasions of the return value of `sub_100036C3` with the string `Str` found throughout the function.
    
    - Furthermore both subroutines `sub_10006518` and `sub_1000664C` utilise the `CreateToolhelp32Snapshot` Windows-API function. This function takes a snapshot of the specified processes, as well as the heaps, modules, and threads used by these processes. - [CreateToolhelp32Snapshot function (tlhelp32.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/tlhelp32/nf-tlhelp32-createtoolhelp32snapshot)

12. Use the graph mode to graph the cross-references from sub_10004E79. Which API functions could be called by entering this function? Based on the API functions alone, what could you rename this function?
    
    - Create xref-graph via *View -> Graphs -> Xrefs from*
      
      ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-07-19-19-31-image.png)
    
    - `GetSystemDefaultLangID`: Returns the language identifier for the system locale. This is the language used when displaying text in programs that do not support Unicode. It is set by the Administrator under **Control Panel** > **Clock, Language, and Region** > **Change date, time, or number formats** > **Administrative** tab. - [GetSystemDefaultLangID function (winnls.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winnls/nf-winnls-getsystemdefaultlangid)
    
    - `sprintf`:
      
      - Function Signature: `int sprintf(char *str, const char *format, ...)`
      
      - The C library function **int sprintf(char *str, const char *format, ...)** sends formatted output to a string pointed to, by **str**.
    
    - `sub_100038EE` (and in it `send`, `malloc`, `free`, `__imp_strlen`: Was before used in the function `int __cdecl sub_100052A2(SOCKET s)`. The parameter `s` of the type SOCKET was then given to this sub-function.
    
    - `strlen`: 
      
      - Function Signature: `size_t strlen(const char *str)`
      
      - The C library function **size_t strlen(const char *str)** computes the length of the string **str** up to, but not including the terminating null character.
    
    - Since the main functionality is implied by the `SOCKET` parameter, `sendSocket` would be a possible fitting name for the function.

13. How many Windows API functions does DllMain call directly? How many at a depth of 2?
    
    - Create graph with *View -> Graph -> User XRef Chart*. Set the start address to `0x1000D02E`and end address to `1000D10A`.  
    
    - A huge graph:
      
      ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-07-19-46-52-image.png)
    
    - API-functions like e.g. `CreateThread`, `SendMessageA`, `OpenInputDesktop`, `TerminateProcess`, `OpenProcess`, `GetProcessAddress`, `StartServiceA`, `GetStartupInofA`, `inet_addr` ...

14. At  0x10001358, there is a call to Sleep (an API function that takes one parameter containing the number of miliseconds to sleep). Looking backward through the code, how long will the program sleep if this code executes?
    
    ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-07-19-59-18-image.png)
    
    - Starting at 0x10001341 we see the value `off_10019020` being loaded into `eax`. `off_10019020` is set to `dd offset aThisIsCti30` (can also be seen in the comment nearby).
    
    - The pointer is then moved by 0x0D (13 dec), hence pointing to the penultimate char 3.
    
    - `eax` gets pushed onto the stack and hence given as an argument to the function `atoi`, which converts the string "30" to an integer.
    
    - Just before the `Sleep` function call, 30 is multiplied by 0x3E8 (1000 dec) and moved onto the stack via `eax`. It is passed as parameter to the `Sleep` function.
    
    - So the answer to the question would be **30 * 1000 = 30000 ms = 300 s**

15. At 0x10001701 is a call to socket. What are the three parameters?
    
    - The three values pushed to the stack, labeled as `protocol`, `type`, and `af`, and are `6`, `1`, `2`respectively, are the three parameters used for the call to socket.
      
      ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-07-20-16-56-image.png)

16. Using the MSDN (Microsoft Documentation) page for `socket` and the named symbolic constants functionality (comments/annotations) in IDA Pro, can you make the parameters more meaningful? What are the parameters after you apply changes?
    
    - Microsoft Documentation page for `socket`:
      
      - The **socket** function creates a socket that is bound to a specific transport service provider
        
        **Synthax:**
        
        ```
        SOCKET WSAAPI socket(
          [in] int af,
          [in] int type,
          [in] int protocol
        );
        ```
      
      - `af`: The address family specification. Supported AF_INET or AF_INET6, which are the Internet address family formats for IPv4 and IPv6.
      
      - `type`: The type specification for the new socket. Defines the type of socket which is to be established.
      
      - `protocol`: The protocol to be used. The possible options for the *protocol* parameter are specific to the address family and socket type specified. Examples include `IPPROTO_ICMP` (ICMP) and `IPPROTO_TCP` (CTP).
      
      - [socket function (winsock2.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-socket)
    
    - Symbolic Constants via IDA:
      
      - The numbers `6`,`1` and `2` each correspond to a parameter:
        
        - `protocol` - `6` - `IPPROTO_TCP` - TCP
        
        - `af` - `2` - `AF_INET` - The Internet Protocol version 4 (IPv4) address family.
        
        - `type` - `1` - `SOCK_STREAM` - A socket type that provides sequenced, reliable, two-way, connection-based byte streams with an OOB data transmission mechanism. This socket type uses the Transmission Control Protocol (TCP) for the Internet address family (AF_INET or AF_INET6).
        
        - [socket function (winsock2.h) - Win32 apps | Microsoft Learn](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-socket)
    
    - To rename those operands, hit *ALT + F1* and input the wished operand's name.

17. Search for usage of the `in` instruction (opcode 0xED). This instruction is used with a magic string VMXh to perform VMware detection. Is that in use in this malware? Using the cross-references to the function that exectutes the in instruction, is there further evidence of VMware detection?
    
    - `in` **Instruction Documentation:**
      
      - Copies the value from the I/O port specified with the second operand 
        (source operand) to the destination operand (first operand). - [Liberation: x86 Instruction Set Reference](https://c9x.me/x86/html/file_module_x86_id_139.html)
      
      - In modern operating systems like Windows or Linux, access to I/O ports 
        is hidden away from "normal" user programs, and there are layers of 
        software, privileged instructions and drivers to deal with the hardware.
         So in this century, most programmers don't deal with those 
        instructions. - [assembly - What are IN &amp; OUT instructions in x86 used for? - Stack Overflow](https://stackoverflow.com/questions/3215878/what-are-in-out-instructions-in-x86-used-for)
      
      - VMware hypervisor is detected by performing an IN operation to port 0x5658 (the VMware hypervisor port). - [VMware Knowledge Base](https://kb.vmware.com/s/article/1009458)
    
    - **IDA:**
      
      - Binary search: Allows you to search for binary patterns with wildcard 
        support. It is also possible to search for strings alongside with the 
        binary patterns. - [Finding instructions &#8211; Hex Rays](https://hex-rays.com/blog/finding-instructions/)
      
      - Search -> Sequence of Bytes
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-08-16-22-16-image.png)
      
      - The function using this instruction is `sub_10006196`:
        
        ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-08-16-23-56-image.png)
      
      - VMware hypervisor is detected by performing an IN operation to port 0x5658 (the VMware hypervisor port).
        
        - From the VMware Article:
          
          ```c
          Doing a IN on port 0x5658 with
          
          eax = 0x564D5868 (VMware hypervisor magic value)
          ebx = 0xFFFFFFFF (UINT_MAX)
          ecx = 10 (Getversion command identifier)
          edx = 0x5658 (hypervisor port number)
          ```
        
        - Found in the Disassembly:
          
          ```c
          .text:100061C7                 mov     eax, 564D5868h
          .text:100061CC                 mov     ebx, 0
          .text:100061D1                 mov     ecx, 0Ah
          .text:100061D6                 mov     edx, 5658h
          .text:100061DB                 in      eax, dx
          ```
        
        - Value `VMX` is present in hex:
          
          ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-08-16-30-42-image.png)
        
        - Looking at the XREFs. Three occurences all of which contain `aFoundVirtualMa`:
          
          ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-08-16-32-47-image.png)
          
          ![](C:\Users\Fabio\AppData\Roaming\marktext\images\2023-12-08-16-34-12-image.png)

18. Jump your cursor to 0x1001D988. What do you find?
    
    - Some sort of string:
    
    ```
    .data:1001D988                 db  2Dh ; -
    .data:1001D989                 db  31h ; 1
    .data:1001D98A                 db  3Ah ; :
    .data:1001D98B                 db  3Ah ; :
    .data:1001D98C                 db  27h ; '
    .data:1001D98D                 db  75h ; u
    .data:1001D98E                 db  3Ch ; <
    .data:1001D98F                 db  26h ; &
    .data:1001D990                 db  75h ; u
    .data:1001D991                 db  21h ; !
    .data:1001D992                 db  3Dh ; =
    .data:1001D993                 db  3Ch ; <
    .data:1001D994                 db  26h ; &
    .data:1001D995                 db  75h ; u
    .data:1001D996                 db  37h ; 7
    .data:1001D997                 db  34h ; 4
    .data:1001D998                 db  36h ; 6
    .data:1001D999                 db  3Eh ; >
    .data:1001D99A                 db  31h ; 1
    .data:1001D99B                 db  3Ah ; :
    .data:1001D99C                 db  3Ah ; :
    .data:1001D99D                 db  27h ; '
    .data:1001D99E                 db  79h ; y
    .data:1001D99F                 db  75h ; u
    .data:1001D9A0                 db  26h ; &
    .data:1001D9A1                 db  21h ; !
    .data:1001D9A2                 db  27h ; '
    .data:1001D9A3                 db  3Ch ; <
    .data:1001D9A4                 db  3Bh ; ;
    .data:1001D9A5                 db  32h ; 2
    .data:1001D9A6                 db  75h ; u
    .data:1001D9A7                 db  31h ; 1
    .data:1001D9A8                 db  30h ; 0
    .data:1001D9A9                 db  36h ; 6
    .data:1001D9AA                 db  3Ah ; :
    .data:1001D9AB                 db  31h ; 1
    .data:1001D9AC                 db  30h ; 0
    .data:1001D9AD                 db  31h ; 1
    .data:1001D9AE                 db  75h ; u
    .data:1001D9AF                 db  33h ; 3
    .data:1001D9B0                 db  3Ah ; :
    .data:1001D9B1                 db  27h ; '
    .data:1001D9B2                 db  75h ; u
    .data:1001D9B3                 db    5
    .data:1001D9B4                 db  27h ; '
    .data:1001D9B5                 db  34h ; 4
    .data:1001D9B6                 db  36h ; 6
    .data:1001D9B7                 db  21h ; !
    .data:1001D9B8                 db  3Ch ; <
    .data:1001D9B9                 db  36h ; 6
    .data:1001D9BA                 db  34h ; 4
    .data:1001D9BB                 db  39h ; 9
    .data:1001D9BC                 db  75h ; u
    .data:1001D9BD                 db  18h
    .data:1001D9BE                 db  34h ; 4
    .data:1001D9BF                 db  39h ; 9
    .data:1001D9C0                 db  22h ; "
    .data:1001D9C1                 db  34h ; 4
    .data:1001D9C2                 db  27h ; '
    .data:1001D9C3                 db  30h ; 0
    .data:1001D9C4                 db  75h ; u
    .data:1001D9C5                 db  14h
    .data:1001D9C6                 db  3Bh ; ;
    .data:1001D9C7                 db  34h ; 4
    .data:1001D9C8                 db  39h ; 9
    .data:1001D9C9                 db  2Ch ; ,
    .data:1001D9CA                 db  26h ; &
    .data:1001D9CB                 db  3Ch ; <
    .data:1001D9CC                 db  26h ; &
    .data:1001D9CD                 db  75h ; u
    .data:1001D9CE                 db  19h
    .data:1001D9CF                 db  34h ; 4
    .data:1001D9D0                 db  37h ; 7
    .data:1001D9D1                 db  75h ; u
    .data:1001D9D2                 db  6Fh ; o
    .data:1001D9D3                 db  7Ch ; |
    .data:1001D9D4                 db  64h ; d
    .data:1001D9D5                 db  67h ; g
    .data:1001D9D6                 db  66h ; f
    .data:1001D9D7                 db  61h ; a
    ```
    
    - Can be made into a string: mark everything and hit *A* or *right-click ->  S+ (symbol)* 
      
      ```
      .data:1001D988 a1UUU7461Yu2u10 db '-1::',27h,'u<&u!=<&u746>1::',27h,'yu&!',27h,'<;2u106:101u3:',27h,'u'
      .data:1001D9B3                 db 5,27h,'46!<649u',18h,'49"4',27h,'0u',14h,';49,&<&u',19h,'47uo|dgfa'
      ```

19. If you have the IDA Python plug-in installed (included with the commercial version of IDA Pro), run Lab05-01.p, an IDA Pro Python script provided with the malware for this book. (Make sure the cursor is at 0x1001D988.) What happens after you run the script?
    
    - **Script:**
      
      ```python
      sea = ScreenEA()
      
      for i in range(0x00,0x50):
              b = Byte(sea+i)
              decoded_byte = b ^ 0x55
              PatchByte(sea+i,decoded_byte)
      ```
      
      - `idc.ScreenEA()` (depricated) / `idc.get_screen_ea()`: Returns the address within the current disassembled file(s) that the user's cursor is positioned at. - [OpenRCE](http://www.openrce.org/reference_library/ida_sdk_lookup/get_screen_ea), [ida - NameError: name &#39;ScreenEA&#39; is not defined - Reverse Engineering Stack Exchange](https://reverseengineering.stackexchange.com/questions/32235/nameerror-name-screenea-is-not-defined), [Porting from IDAPython 6.x-7.3, to 7.4](https://hex-rays.com/products/ida/support/ida74_idapython_no_bc695_porting_guide.shtml)
      
      - `idc.PatchByte()` (depricated) / `ida_bytes.patch_byte`: Change value of a program byte - [IDA Help: patch_byte](https://www.hex-rays.com/products/ida/support/idadoc/713.shtml), [ida_bytes API documentation](https://www.hex-rays.com/products/ida/support/idapython_docs/ida_bytes.html)
      
      - `range(0x00,0x50)`: from bytes 0x00 to 0x50 (80 dec)
    
    - It decodes the string. Since I do not have IDA Pro, I cannot test this functionality.
    
    - **Manually:**
      
      - Using cyberchef - [CyberChef](https://gchq.github.io/CyberChef/)
        
        - `-1::' 27h 'u<&u!=<&u746>1::' 27h 'yu&!' 27h '<;2u106:101u3:' 27h 'u' 5 27h '46!<649u' 18h '49"4' 27h '0u' 14h ';49 &<&u' 19h '47uo|dgfa`
          
          **Output:**
          
          "xdoorugb=ur is this backdoorugb=ur, strugb=uring decoded forugb=ur ru`ugb=uractical rudm=uralwarugb=ure ruda=urnalusis rudl=urab :)1234"
        
        - `'-1::' 'u<&u!=<&u746>1::' 'yu&!' '<;2u106:101u3:' 'u' 5 '46!<649u' '49"4' '0u' ';49 &<&u' '47uo|dgfa'`
          
          **Output:**
          
          rxdoorur is this backdoorur, struring decoded forur ru`uractical ruralwarure rurnalusis rurab :)1234r
        
        - The ASCII encoding is a little messed up.
      
      - The actual string should be:
        
        **"rxdoor is this backdoor, string decoded for Practical Malware Analysis Lab :)1234"**

20. With the cursor in the same location, how do you turn this data into a single ASCII string?
    
    - done

21. Open the script with a text editor. How does it work?
    
    - done

---

References:

- https://medium.com/ce-malware-analysis/lab-5-ida-pro-bb7c7772dd99
